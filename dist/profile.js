"use strict";(()=>{Webflow.push(function(){window.$memberstackDom.getCurrentMember().then(({data:m})=>{if(m){console.log("local"),console.log("local");let f=localStorage.getItem("imageFile");localStorage.getItem("imageUrl")&&f&&(document.querySelector('[discover-element="profile-image"]').src=f);let _=window.location.href,y=new URLSearchParams(new URL(_).search);if(y.has("tab")){let o=y.get("tab");document.querySelector(`[data-w-tab="${o}"]`).click()}let L=document.querySelector('[discover-element="update-password"]'),T=document.querySelector('[discover-element="submit-password"]'),g=document.querySelector(".profile_header_form-error"),E=document.querySelector('[discover-element="new-password"]'),M=document.querySelector('[discover-element="new-password2"]');L.addEventListener("click",()=>{E.value===M.value?(g.style.display="none",T.click()):g.style.display="block"});let u=localStorage.getItem("types"),c=u==null?void 0:u.split(","),p=localStorage.getItem("fields"),a=p==null?void 0:p.split(","),S=document.querySelectorAll('[discover-element="type-embed"]'),h=document.querySelectorAll('[discover-element="field-embed"]'),i=document.querySelector('[discover-element="type-template"]'),d=document.querySelector('[discover-element="field-template"]'),b=o=>{i.style.display="flex";let{parentElement:t}=i,{children:l}=t;for(let e=l.length-1;e>0;e--)t.removeChild(l[e]);S.forEach(e=>{let r=e.querySelector(".profile_header_interests-id").innerHTML;if(c!=null&&c.includes(r)){o==="localStorage"&&e.getElementsByTagName("input")[0].click();let s=e.querySelector(".profile_header_tabs-interest").innerHTML,n=i.cloneNode(!0);n.innerHTML=s,i.parentElement.append(n)}}),i.style.display="none"},v=o=>{d.style.display="flex";let{parentElement:t}=d,{children:l}=t;for(let e=l.length-1;e>0;e--)t.removeChild(l[e]);h.forEach(e=>{let r=e.querySelector(".profile_header_interests-id").innerHTML;if(a!=null&&a.includes(r)){o==="localStorage"&&e.getElementsByTagName("input")[0].click();let s=e.querySelector(".profile_header_tabs-interest").innerHTML,n=d.cloneNode(!0);n.innerHTML=s,d.parentElement.append(n)}}),d.style.display="none"};b("localStorage"),v("localStorage");let F=document.querySelector('[d-e="types-form"]'),C=document.querySelector('[d-e="fields-form"]'),U=document.querySelector('[d-e="update-types"]'),H=document.querySelector('[d-e="update-fields"]'),q=(o,t)=>{var l=new Headers;l.append("Content-Type","application/json");let e=localStorage.getItem("airtableId");var r=JSON.stringify({event:o,payload:t,id:e}),s={method:"PUT",headers:l,body:r,redirect:"follow"};fetch(`https://discover-plus-server.herokuapp.com/api/v1/user/${m.id}`,s).then(n=>n.text()).then(n=>{var I,k;o==="types.updated"?(b("api"),localStorage.setItem("types",c.join(",")),(I=document.querySelector('[discover-element="add-remove-types"]'))==null||I.click()):o==="fields.updated"&&(v("api"),localStorage.setItem("fields",a.join(",")),(k=document.querySelector('[discover-element="add-remove-fields"]'))==null||k.click()),console.log(n)}).catch(n=>console.log("error",n))};U.addEventListener("click",o=>{c=[],S.forEach(t=>{let l=t.querySelector(".profile_header_interests-id").innerHTML,e=t.querySelector('[d-e="checkbox"]'),r=!1;e.classList.contains("w--redirected-checked")&&(r=!0,c.push(l))}),q("types.updated",c)}),H.addEventListener("click",o=>{a=[],h.forEach(t=>{let l=t.querySelector(".profile_header_interests-id").innerHTML,e=t.querySelector('[d-e="checkbox"]'),r=!1;e.classList.contains("w--redirected-checked")&&(r=!0,a.push(l))}),q("fields.updated",a)});let w=document.getElementById("image-form");document.querySelector("#image-input").addEventListener("change",o=>{if(o.target.files[0].size>1*1024*1024){console.error("File size exceeds 1MB limit"),document.querySelector(".profile_header_image-message").innerHTML="File size sould be less than 1mb",document.querySelector(".profile_header_image-message").style.display="block";return}document.querySelector(".profile_header_image-message").style.display="none",document.querySelector("#profile_header_image-button").style.display="block"});let R=async o=>{try{let l=await(await fetch(o)).blob(),e=new FileReader;e.onloadend=function(){let r=e.result;localStorage.setItem("imageFile",r),localStorage.setItem("imageUrl",o),document.querySelector('[discover-element="navbar-image"]').src=r,document.querySelector('[discover-element="profile-image"]').src=r},e.readAsDataURL(l)}catch(t){console.error("Error fetching and storing image:",t)}};w.addEventListener("submit",async function(o){o.preventDefault();let t=localStorage.getItem("airtableId");if(document.querySelector("#image-input").files[0].size>1*1024*1024){console.error("File size exceeds 1MB limit");return}let e=new FormData(w);e.append("id",`${t}`);let r=await fetch(`https://discover-plus-server.herokuapp.com/api/v1/user/${m.id}`,{method:"PUT",body:e,event:"image.updated"});if(r.ok){let s=await r.json();console.log("Image uploaded successfully",s),R(s.imageUrl)}else console.error("Error uploading image:",r.status,r.statusText)})}})});})();
