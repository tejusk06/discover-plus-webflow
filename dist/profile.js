"use strict";(()=>{Webflow.push(function(){window.$memberstackDom.getCurrentMember().then(({data:m})=>{if(m){let y=localStorage.getItem("imageFile"),L=localStorage.getItem("imageUrl"),T=window.location.href,f=new URLSearchParams(new URL(T).search),E=document.querySelector('[discover-element="update-password"]'),M=document.querySelector('[discover-element="submit-password"]'),g=document.querySelector(".profile_header_form-error"),H=document.querySelector('[discover-element="new-password"]'),U=document.querySelector('[discover-element="new-password2"]'),u=localStorage.getItem("types"),c=u==null?void 0:u.split(","),p=localStorage.getItem("fields"),a=p==null?void 0:p.split(","),S=document.querySelectorAll('[discover-element="type-embed"]'),h=document.querySelectorAll('[discover-element="field-embed"]'),i=document.querySelector('[discover-element="type-template"]'),d=document.querySelector('[discover-element="field-template"]'),j=document.querySelector('[d-e="types-form"]'),z=document.querySelector('[d-e="fields-form"]'),x=document.querySelector('[d-e="update-types"]'),R=document.querySelector('[d-e="update-fields"]'),q=document.getElementById("image-form"),B=document.querySelector("#image-input"),F=document.querySelector('[data-ms-member="profile-type"]'),b=document.querySelector('[discover-element="age-wrap"]');if(L&&y&&(document.querySelector('[discover-element="profile-image"]').src=y),f.has("tab")){let t=f.get("tab");document.querySelector(`[data-w-tab="${t}"]`).click()}E.addEventListener("click",()=>{H.value===U.value?(g.style.display="none",M.click()):g.style.display="block"});let v=t=>{i.style.display="flex";let{parentElement:o}=i,{children:l}=o;for(let e=l.length-1;e>0;e--)o.removeChild(l[e]);S.forEach(e=>{let r=e.querySelector(".profile_header_interests-id").innerHTML;if(c!=null&&c.includes(r)){t==="localStorage"&&e.getElementsByTagName("input")[0].click();let s=e.querySelector(".profile_header_tabs-interest").innerHTML,n=i.cloneNode(!0);n.innerHTML=s,i.parentElement.append(n)}}),i.style.display="none"},w=t=>{d.style.display="flex";let{parentElement:o}=d,{children:l}=o;for(let e=l.length-1;e>0;e--)o.removeChild(l[e]);h.forEach(e=>{let r=e.querySelector(".profile_header_interests-id").innerHTML;if(a!=null&&a.includes(r)){t==="localStorage"&&e.getElementsByTagName("input")[0].click();let s=e.querySelector(".profile_header_tabs-interest").innerHTML,n=d.cloneNode(!0);n.innerHTML=s,d.parentElement.append(n)}}),d.style.display="none"};v("localStorage"),w("localStorage");let _=(t,o)=>{var l=new Headers;l.append("Content-Type","application/json");let e=localStorage.getItem("airtableId");var r=JSON.stringify({event:t,payload:o,id:e}),s={method:"PUT",headers:l,body:r,redirect:"follow"};fetch(`https://discover-plus-server.herokuapp.com/api/v1/user/${m.id}`,s).then(n=>n.text()).then(n=>{var k,I;t==="types.updated"?(v("api"),localStorage.setItem("types",c.join(",")),(k=document.querySelector('[discover-element="add-remove-types"]'))==null||k.click()):t==="fields.updated"&&(w("api"),localStorage.setItem("fields",a.join(",")),(I=document.querySelector('[discover-element="add-remove-fields"]'))==null||I.click()),console.log(n)}).catch(n=>console.log("error",n))};x.addEventListener("click",t=>{c=[],S.forEach(o=>{let l=o.querySelector(".profile_header_interests-id").innerHTML,e=o.querySelector('[d-e="checkbox"]'),r=!1;e.classList.contains("w--redirected-checked")&&(r=!0,c.push(l))}),_("types.updated",c)}),R.addEventListener("click",t=>{a=[],h.forEach(o=>{let l=o.querySelector(".profile_header_interests-id").innerHTML,e=o.querySelector('[d-e="checkbox"]'),r=!1;e.classList.contains("w--redirected-checked")&&(r=!0,a.push(l))}),_("fields.updated",a)}),B.addEventListener("change",t=>{if(t.target.files[0].size>1*1024*1024){console.error("File size exceeds 1MB limit"),document.querySelector(".profile_header_image-message").innerHTML="File size sould be less than 1mb",document.querySelector(".profile_header_image-message").style.display="block";return}document.querySelector(".profile_header_image-message").style.display="none",document.querySelector("#profile_header_image-button").style.display="block"});let C=async t=>{try{let l=await(await fetch(t)).blob(),e=new FileReader;e.onloadend=function(){let r=e.result;localStorage.setItem("imageFile",r),localStorage.setItem("imageUrl",t),document.querySelector('[discover-element="navbar-image"]').src=r,document.querySelector('[discover-element="profile-image"]').src=r},e.readAsDataURL(l)}catch(o){console.error("Error fetching and storing image:",o)}};q.addEventListener("submit",async function(t){t.preventDefault(),document.querySelector(".profile_header_image-message").innerHTML="Uploading Image",document.querySelector(".profile_header_image-message").style.display="block";let o=localStorage.getItem("airtableId");if(document.querySelector("#image-input").files[0].size>1*1024*1024){console.error("File size exceeds 1MB limit");return}let e=new FormData(q);e.append("id",`${o}`);let r=await fetch(`https://discover-plus-server.herokuapp.com/api/v1/user/${m.id}`,{method:"PUT",body:e,event:"image.updated"});if(r.ok){let s=await r.json();console.log("Image uploaded successfully",s),C(s.imageUrl),document.querySelector(".profile_header_image-message").style.display="none"}else document.querySelector(".profile_header_image-message").innerHTML="Error",console.error("Error uploading image:",r.status,r.statusText)}),F.addEventListener("change",function(t){t.target.value==="Student"?b.style.display="block":b.style.display="none"})}})});})();
